<div class="wrapper">
  <div class="danekerscode">
    <div class="left">
      <div class="top">
        <input type="text" placeholder="Search" />
        <tui-svg
          class="ml-4 mt-2"
          src="tuiIconUser"
          title="Edit profile"
          (click)="showDialog(editProfile, 'Edit profile')"
        >
        </tui-svg>
        <tui-svg
          src="tuiIconSearch"
          class="ml-4 mt-2"
          title="Find users"
          (click)="showDialog(userListModal, 'Find users')"
        >
        </tui-svg>
        <tui-svg
          src="tuiIconLogOut"
          class="ml-4 mt-2"
          title="Logout"
          (click)="showDialog(logoutModal, 'Are you sure to logout')"
        >
        </tui-svg>
        <tui-svg
          *ngIf="user.role === 'ADMIN'"
          src="tuiIconUsers"
          class="ml-4 mt-2"
          title="All users"
          (click)="navigateToUsersPage()"
        >
        </tui-svg>
      </div>
      <ul class="people">
        <li
          *ngFor="let chat of chats"
          class="person"
          id="dadadda"
          [attr.data-chat]="'person' + chat.id"
        >
          <img alt="" [src]="imageLink(getSecondMember(chat).id)" />
          <span class="name">{{ getSecondMember(chat).username }}</span>
          <span class="time">2:09 PM</span>
          <span class="preview">I was wondering...</span>
        </li>
      </ul>
    </div>
    <div class="right" *ngIf="currentChat">
      <div class="top">
        <span
          >To:
          <span class="name">{{
            getSecondMember(currentChat).username
          }}</span></span
        >
      </div>

      <div class="chat" *ngIf="currentChat; else noAnyChats">
        <div class="conversation-start">
          <span>{{
            getLastMessage(currentChat).sentAt | date : "dd/MM/yyyy hh:mm a"
          }}</span>
        </div>
        <div
          *ngFor="let message of currentChat.messages"
          [ngClass]="{
            bubble: true,
            me: message.senderId === user.id,
            you: message.senderId !== user.id
          }"
        >
          {{ message.content }}
        </div>
      </div>

      <div class="write">
        <input type="text" #messageInput />
        <a
          href="javascript:;"
          class="write-link send"
          (click)="sendMessage(messageInput.value!)"
        ></a>
      </div>
    </div>
  </div>
</div>
<ng-template #noAnyChats>
  <div class="chat">
    <div class="bubble">No any chats. Find users and try to start chat</div>
  </div>
</ng-template>
<ng-template let-observed #editProfile>
  <form [formGroup]="editProfileForm" (submit)="onEditUsername()">
    <div class="flex flex-col justify-center">
      <tui-avatar
        id="avatar"
        fallback="tuiIconUserLarge"
        new
        class="tui-space_left-3 avatar inline-block"
        [avatarUrl]="imageLink(user.id)"
        [size]="'xl'"
        (click)="fileInput.click()"
        title="Upload new profile image"
      >
        <input
          hidden
          #fileInput
          type="file"
          class="w-full h-full"
          accept="image/*"
          (change)="onFileSelected($event)"
        />
      </tui-avatar>

      <div class="tui-form__row">
        <tui-input
          formControlName="username"
          tuiHintContent="Username"
          class="w-52"
        >
          Username
          <input tuiTextfield [required]="true" />
          <span class="tui-required"></span>
        </tui-input>
        <tui-error
          formControlName="username"
          [error]="[] | tuiFieldError | async"
        ></tui-error>
      </div>

      <div class="tui-form__buttons">
        <button
          size="m"
          tuiButton
          type="submit"
          class="tui-form__button"
          [class.tui-skeleton_light]="false"
          [class.tui-skeleton]="false"
        >
          Submit
        </button>
      </div>
    </div>
  </form>
</ng-template>

<ng-template #logoutModal let-observed>
  <div>
    <button
      size="m"
      tuiButton
      type="submit"
      class="float-right"
      (click)="logout()"
    >
      YES
    </button>
  </div>
</ng-template>

<ng-template let-observed #userListModal>
  <form [formGroup]="userSearchForm">
    <div class="tui-form__row">
      <tui-input formControlName="query" tuiHintContent="Username" class="w-52">
        Username
        <input tuiTextfield [required]="true" />
      </tui-input>
    </div>
    <ng-container *ngFor="let fetchUser of fetchedUsers | async" class="pt-8">
      <div class="border border-gray-600 shadow-md p-4 flex relative">
        <tui-avatar
          fallback="tuiIconUserLarge"
          new
          class="tui-space_left-3 avatar inline-block"
          [avatarUrl]="imageLink(fetchUser.id)"
          [size]="'m'"
        >
        </tui-avatar>
        <div class="text-black pt-1 pl-4">
          {{ fetchUser.username }}
        </div>
        <tui-svg
          src="tuiIconMessageCircleLarge"
          class="ml-52 float-right block pt-2"
          title="Start chat"
          (click)="createChat(fetchUser.id)"
        >
        </tui-svg>
      </div>
    </ng-container>
  </form>
</ng-template>
